id: decide
description: Build prompts that compare options and recommend decisions
signature_template: input_context, objective, constraints -> compiled_prompt, checks
prompt_style: decision_contract
compiler_principles: |
  You are an expert prompt engineer specializing in decision-support tasks. Generate a
  single, production-quality system prompt that functions as a complete behavior contract
  for structured decision-making.

  ## Generation Principles

  1. **Decision Analyst Role**: Open with a role as a structured decision analyst with the
     relevant domain expertise. Establish that recommendations must be traceable.
  2. **Constraint Fidelity**: Include ONLY constraints from the user's intent. Never invent
     decision criteria, risk thresholds, or approval processes not in the request.
  3. **Enumerate Options First**: Require explicit listing of all feasible options before
     any evaluation. Prevent premature convergence on a single choice.
  4. **Explicit Criteria and Weights**: Decision criteria must be named and their relative
     importance stated. No implicit trade-offs.
  5. **Chain-of-Thought Evaluation**: Require step-by-step reasoning for each option against
     each criterion. No summary conclusions without supporting reasoning.
  6. **Deterministic Recommendation**: Define a clear recommendation rule including tie-break
     logic. The output should be reproducible given the same inputs.
  7. **Evidence vs. Assumption Separation**: Label what is known fact vs. what is assumed.
     Assumptions must be flagged as such and their impact acknowledged.
  8. **Measurable Criteria**: Use specific thresholds from the intent (e.g., "latency < 200ms",
     "cost reduction > 20%"). Avoid relative comparisons without anchors.
  9. **Output Contract**: Define the decision payload: what fields are required, what format
     the recommendation takes, and how to handle cases with insufficient information.

  ## Quality Standard

  Every instruction must support traceable, auditable decision-making. Be specific about
  criteria, weights, and evaluation logic. Never pad with generic decision advice.
refine_principles: |
  You are refining an existing decision prompt. Apply surgical, targeted improvements.

  ## Refinement Protocol

  1. **Diagnose First**: Identify the 2-3 highest-impact weaknesses from judge feedback.
  2. **Preserve What Works**: Keep sections that scored well.
  3. **Priority Order**: Missing criteria → unclear recommendation rule → weak evidence
     standards → clarity issues.
  4. **Strip Hallucinations**: Remove any criterion, threshold, or process NOT in the
     user's intent.
  5. **Clarify Recommendation Logic**: If the recommendation rule is ambiguous or missing
     tie-break handling, add it explicitly.
  6. **Strengthen Chain-of-Thought**: If the evaluation method lacks step-by-step reasoning
     for each option, add explicit evaluation steps.
  7. **Remove Structural Noise**: Strip envelope tags, bracket markup, duplicate sections.
prompt_directives:
  - Open with a role definition as a structured decision analyst
  - Use semantic XML tags to organize sections (e.g., <options>, <criteria>, <scoring_method>, <constraints>, <output_format>, <failure_policy>, <examples>)
  - Enumerate feasible options before scoring — require explicit listing
  - Use explicit decision criteria and weighting rules with concrete thresholds
  - Require step-by-step chain-of-thought evaluation of each option against each criterion
  - Require transparent recommendation logic and tie-break handling
  - Separate objective evidence from assumptions, labeling each clearly
  - End with a testable output contract defining the decision payload format
  - Be dense and comprehensive — fill the token budget with actionable, specific guidance
  - Do NOT wrap the entire prompt in <system> or <prompt> envelope tags
quality_checklist:
  - options are explicit and mutually distinguishable
  - ALL constraints come from the user's intent — no hallucinated policies or rules
  - output format is NOT specified unless the user explicitly requested one
  - criteria and weighting are explicit and auditable
  - evaluation uses chain-of-thought reasoning for each option
  - recommendation rule is deterministic with clear tie-break logic
  - output contract reflects the user's actual success criteria
  - role/identity is established in the opening lines
clarification_policy:
  - Ask for missing criteria or priorities when they change outcomes
  - Ask for hard constraints before final recommendation
ambiguity_resolution_rules:
  - If criteria are missing, infer baseline criteria and label assumptions clearly
  - If constraints conflict, prioritize safety and user-stated hard constraints
forbidden_patterns:
  - maybe
  - depends
  - generally
  - single-message only
  - exactly 3 rounds
  - arbitrary word limit
  - '[section]'
  - '[[block]]'
  - <system>
friction_markers:
  - in one message
  - single user message
  - maximum two rounds
  - at most two
  - up to three clarification rounds
  - allow up to three clarification attempts
  - interaction will end
  - after two clarification attempts
  - after three clarification attempts
  - "≤\u202f2,000 words"
  - 2,000 words per question
  - cited directly after the statement
  - in parentheses
  - "[instruction_hierarchy]"
  - "[input_boundary]"
  - "[failure_policy]"
  - "[output_contract]"
  - "[final_self_check]"
  - "[[instruction_hierarchy]]"
  - "[[input_boundary]]"
  - "[[failure_policy]]"
  - "[[output_contract]]"
  - "[[final_self_check]]"
  - "<prompt>"
  - "</system>"
required_sections:
  - goal
  - options
  - decision_criteria
  - scoring_method
  - recommendation_rule
  - output_contract
required_prompt_blocks:
  - instruction_hierarchy
  - input_boundary
  - failure_policy
  - output_contract
  - final_self_check
required_technique_markers:
  - objective
  - constraints
  - options
  - criteria
  - output contract
vague_markers:
  - maybe
  - depends
  - could be
  - likely
  - generally
ambiguity_penalty_per_marker: 0.04
ambiguity_penalty_cap: 0.35
missing_sections_weight: 0.25
missing_techniques_weight: 0.20
eval_weights:
  quality: 0.45
  clarity: 0.25
  constraint_fit: 0.2
  brevity: 0.1
judge_rubric:
  priorities:
    - enforce explicit criteria and scoring logic
    - penalize recommendations without traceable rationale
  quality_checks:
    - options are compared with explicit criteria
    - recommendation rule is deterministic and auditable
  clarity_checks:
    - decision flow is unambiguous
    - avoids contradictory tie-break logic
  constraint_checks:
    - constraints are enforced in scoring and recommendation
    - output contract defines decision payload clearly
  risk_checks:
    - flags unsupported recommendations
    - flags missing decision criteria or weights
